!function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,t.jQuery||require("jquery")):function(){var t=require("jquery");return function(r){return e(r,r.jQuery||t(r))}}():t.Fluid=e(t,jQuery)}("undefined"!=typeof window?window:this,function(window,$){"use strict";function jqFind(t,e){return""==e?t:t.filter(e).add(t.find(e))}function rndStr(){return"_"+Math.random().toString(36).substr(2,6)+Math.random().toString(36).substr(2,6)}function isCheckable(t){var e=("INPUT"==t[0].tagName.toUpperCase()&&t.attr("type")||"").toUpperCase();return"CHECKBOX"==e||"RADIO"==e}function wrapExtFunctions(t,e){function r(t){return function(){return t.apply(this[n],arguments)}}var n=rndStr();for(var i in t)t[e+"_"+i]=r(t[i]);return n}function addExtFunctions(t){for(var e in t)null==extFuns[e]&&(extFuns[e]=[]),extFuns[e].push(t[e])}function callExtFun(){var t,e,r,n=arguments[0];"string"==typeof arguments[1]?(e=!1,t=arguments[1],r=Array.prototype.slice.call(arguments,2)):(e=arguments[1],t=arguments[2],r=Array.prototype.slice.call(arguments,3));for(var i=extFuns[t]||[],a=0;a<i.length;a++){var o=i[a].apply(n,r);e&&(r[0]=o)}return e?r[0]:void 0}function model_get(){return this()}function model_set(t){return this(t)}function addValSyntax(t){if(Object.defineProperty)try{Object.defineProperty(t,"val",{get:model_get,set:t.set})}catch(e){}}function model_sub(t){var e=this,r=function(){return arguments.length>0?(e()[t]=arguments[0],e.alert(),arguments[0]):e()[t]};return $.extend(r,e),addValSyntax(r),r}function AbstractView(){}function setVal(t,e,r){isCheckable(e)?e[0].checked=r:(r=callExtFun(t,!0,"view_preprocessValue",r,e),e.val()!=r&&(e.val(r),callExtFun(t,"view_postValueProcessing",r,e)))}var Fluid={},isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};Fluid.utils={},Fluid.utils.rndAttrName=rndStr,Fluid.utils.isCheckable=isCheckable;var extFuns={};return Fluid.extendViews=function(t){var e=wrapExtFunctions(t,"view");t.view_initPrototype=function(){this[e]=function(){}},t.view_initInstance=function(){var t=this;this[e]=new this[e],this[e].getState=function(){return t.state},this[e].find=function(e){return jqFind(t.$el,e)}},addExtFunctions(t)},Fluid.extendModels=function(t){var e=wrapExtFunctions(t,"model");t.model_initInstance=function(){this[e]={}},addExtFunctions(t)},Fluid.newModel=function(t){var e=function(){return arguments.length>0&&(t=arguments[0],e.alert()),t};callExtFun(e,"model_initInstance"),t=callExtFun.apply({},Array.prototype.concat.apply([e,!0,"model_compile"],arguments));var r=[];return e.listen=r.push.bind(r),e.alert=function(){for(var t=0;t<r.length;t++)r[t]();callExtFun(e,"model_alert",e)},e.get=model_get,e.set=model_set,e.sub=model_sub,addValSyntax(e),callExtFun(e,"model_init",e),e},AbstractView.prototype.update=function(t){function e(t,e){o-=(new Date).getTime(),1==arguments.length?t.update():t.update(e),o+=(new Date).getTime()}if(this.state=(t||{}).state||this.state,!this.noMemoize&&(this.memoTime||0)<=(this.updateTime||0)/2){var r=(new Date).getTime(),n=JSON.stringify(this.state),i=n==this.oldStateHash,a=(new Date).getTime()-r;if(this.memoTime=(4*(this.memoTime||a)+a)/5,i)return;this.oldStateHash=n}else this.oldStateHash=void 0;var o=(new Date).getTime(),s=this.fill.apply(this,this.state),l=null!=this.vals;l||(this.$el=this.getFreshJQ(),this.vals={},this.initCnt=(this.initCnt||0)+1,callExtFun(this,"view_initInstance"),callExtFun(this,"view_init"));for(var p in this.valCommands)if(s.hasOwnProperty(p))for(var u=s[p],c=this.valCommands[p],m=0;m<c.length;m++)setVal(this,jqFind(this.$el,"["+c[m]+"]"),u);for(var p in this.attrCommands)if(s.hasOwnProperty(p)){var u=s[p];if(!l||this.vals[p]!=u)for(var f in this.attrCommands[p]){var d=jqFind(this.$el,"["+f+"]");d.attr(this.attrCommands[p][f],u)}}for(var p in this.textCommands)if(s.hasOwnProperty(p)){var u=s[p];if(!l||this.vals[p]!=u)for(var h=this.textCommands[p],m=0;m<h.length;m++)jqFind(this.$el,"["+h[m]+"]").text(u)}for(var f in this.cmplxAttrCmds){for(var v=this.cmplxAttrCmds[f],u="",m=0;void 0!=u&&m<v.format.length;m++)m%2==0?u+=v.format[m]:s.hasOwnProperty(v.format[m])?u+=s[v.format[m]]:u=void 0;if(void 0!=u){var d=jqFind(this.$el,"["+f+"]");"VALUE"==v.attr.toUpperCase()?setVal(this,d,u):d.attr(v.attr,u)}}for(var p in this.viewCommands)if(s.hasOwnProperty(p)){var t=s[p],y=this.vals[p],d=jqFind(this.$el,"#"+this.viewCommands[p]);if(isArray(t)){if(l)if(isArray(y)){for(var w=Math.min(t.length,y.length),m=0;w>m;m++)y[m].typeHash!=t[m].typeHash&&(w=m);for(;y.length>w;)y[y.length-1].$el.remove(),y.length--}else{if(y instanceof AbstractView)y.$el.remove();else if(y instanceof Object)for(var g in y)y[g]instanceof AbstractView&&y[g].$el.remove();y=[]}else y=[];for(var m=0;m<y.length;m++)e(y[m],t[m]),t[m]=y[m];for(var m=y.length;m<t.length;m++)e(t[m]),d.before(t[m].$el)}else if(t instanceof AbstractView){var V=!0;if(l)if(isArray(y))for(var m=0;m<y.length;m++)y[m].$el.remove();else if(y instanceof AbstractView)y.typeHash!=t.typeHash?y.$el.remove():(V=!1,e(y,t),s[p]=y);else if(y instanceof Object)for(var g in y)y[g]instanceof AbstractView&&y[g].$el.remove();V&&(e(t),d.before(t.$el))}else if(t instanceof Object){if(l){if(isArray(y)){for(var m=0;m<y.length;m++)y[m].$el.remove();y={}}else if(y instanceof AbstractView)y.$el.remove(),y={};else if(y instanceof Object)for(var x in y)y[x]instanceof AbstractView?t[x]instanceof AbstractView&&t[x].typeHash==y[x].typeHash||(y[x].$el.remove(),y[x]=void 0):y[x]=void 0}else y={};var F=[];for(var g in t)t[g]instanceof AbstractView&&F.push(g);t.__SORT__&&(t.__SORT__ instanceof Function?F.sort(t.__SORT__):F.sort());for(var m=F.length-1;m>=0;m--){var g=F[m];void 0==y[g]?(e(t[g]),(m+1==F.length?d:t[F[m+1]].$el).before(t[g].$el)):(e(y[g],t[g]),t[g]=y[g])}}}this.vals=s,callExtFun(this,"view_control"),l||this.addControls.apply(this,[this.$el].concat(this.state)),this.updateControls.apply(this,[l,this.$el].concat(this.state));var C=(new Date).getTime()-o;this.updateTime=(4*(this.updateTime||C)+C)/5},Fluid.compileView=function(props){function View(){this.state=Array.prototype.slice.call(arguments,0)}arguments.length=arguments.length||1,arguments[0]=props=props||{},View.prototype=new AbstractView,callExtFun(View.prototype,"view_initPrototype");var protoProtos={};for(var key in View.prototype)protoProtos[key]=View.prototype[key].prototype;callExtFun.apply({},Array.prototype.concat.apply([protoProtos,"view_compile"],arguments)),View.prototype.fill=props.fill||function(){return new Object},View.prototype.addControls=props.addControls||function(){},View.prototype.updateControls=props.updateControls||function(){},View.prototype.noMemoize=!!props.noMemoize,View.prototype.typeHash=rndStr(),View.prototype.valCommands={},View.prototype.attrCommands={},View.prototype.textCommands={},View.prototype.cmplxAttrCmds={},View.prototype.viewCommands={};var template=props.template||"";return template=callExtFun(protoProtos,!0,"view_modifyTemplate",template).replace(/[^\s]+=['"]{{\s*\w+\s*}}['"]/g,function(t){var e=t.lastIndexOf('"{{');return-1==e&&(e=t.lastIndexOf("'{{")),t.slice(0,e)+t.slice(e+1,-1)}).replace(/value={{\s*\w+\s*}}/g,function(t){var e=t.slice(8,-2).trim(),r=rndStr();return null==View.prototype.valCommands[e]&&(View.prototype.valCommands[e]=[]),View.prototype.valCommands[e].push(r),r}).replace(/[^\s]+={{\s*\w+\s*}}/g,function(t){var e=t.lastIndexOf("="),r=t.slice(0,e),n=t.slice(e+3,-2).trim(),i=rndStr();return null==View.prototype.attrCommands[n]&&(View.prototype.attrCommands[n]={}),View.prototype.attrCommands[n][i]=r,i}).replace(/>\s*{{\s*\w+\s*}}\s*</g,function(t){var e=t.slice(1,-1).trim().slice(2,-2).trim(),r=rndStr();return null==View.prototype.textCommands[e]&&(View.prototype.textCommands[e]=[]),View.prototype.textCommands[e].push(r)," "+r+"><"}).replace(/[^\s]+=(?:"[^"]*?{{\s*\w+\s*}}(?:[^"]*?[^\\])?"|'[^']*?{{\s*\w+\s*}}(?:[^']*?[^\\])?')/g,function(match){var i=match.indexOf("="),attr=match.substr(0,i),q=match.substr(i+1,1),format=match.slice(i+2,-1).split(/{{|}}/);for(i=0;i<format.length;i+=2)format[i]=eval(q+format[i]+q);var id=rndStr();return View.prototype.cmplxAttrCmds[id]={attr:attr,format:format},id}).replace(/\[\[\s*\w+\s*\]\]/g,function(t){var e=t.slice(2,-2).trim(),r=rndStr();return View.prototype.viewCommands[e]=r,"<span id='"+r+"' style='display: none'></span>"}),View.prototype.getFreshJQ=function(){return $(template)},View},Fluid.attachView=function(t,e){function r(){for(var t=[],r=0;r<i.length;r++)t.push(i[r].get());e.apply(this,t)}function n(){a.update(new r)}var i=Array.prototype.slice.call(arguments,2);r.prototype=e.prototype;var a=new r;a.update();for(var o=0;o<i.length;o++)i[o].listen(n);t.replaceWith(a.$el)},Fluid});