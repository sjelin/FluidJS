!function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=t.jQuery?e(t.jQuery):t.document?e(require("jquery")):function(){var t=require("jquery");return function(r){return e(r.jQuery||t(r))}}():t.Fluid=e(jQuery)}("undefined"!=typeof window?window:this,function(t){"use strict";function e(){return this()}function r(t){return this(t)}function n(t){if(Object.defineProperty)try{Object.defineProperty(t,"val",{get:e,set:t.set})}catch(r){}}function o(e){var r=this,o=function(){return arguments.length>0?(r()[e]=arguments[0],r.alert(),arguments[0]):r()[e]};return t.extend(o,r),n(o),o}function a(){}function s(){return"_"+Math.random().toString(36).substr(2,6)+Math.random().toString(36).substr(2,6)}var i={},l=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},p=function(t,e){return""==e?t:t.filter(e).add(t.find(e))};i.newModel=function(t){var a=[],s=function(){return arguments.length>0&&(t=arguments[0],s.alert()),t};return s.listen=a.push.bind(a),s.alert=function(){for(var t=0;t<a.length;t++)a[t]()},s.get=e,s.set=r,s.sub=o,n(s),s},a.prototype.update=function(t){function e(t,e){i-=(new Date).getTime(),1==arguments.length?t.update():t.update(e),i+=(new Date).getTime()}if(this.state=(t||{}).state||this.state,!this.noMemoize&&(this.memoTime||0)<=(this.updateTime||0)/2){var r=(new Date).getTime(),n=JSON.stringify(this.state),o=n==this.oldStateHash,s=(new Date).getTime()-r;if(this.memoTime=(4*(this.memoTime||s)+s)/5,o)return;this.oldStateHash=n}else this.oldStateHash=void 0;var i=(new Date).getTime(),u=this.calc.apply(this,this.state),f=null!=this.vals;f||(this.$el=this.getFreshJQ(),this.vals={});for(var h in this.valCommands)if(u.hasOwnProperty(h))for(var m=u[h],c=this.valCommands[h],v=0;v<c.length;v++){var d=p(this.$el,"["+c[v]+"]");d.val()!=m&&d.val(m)}for(var h in this.attrCommands)if(u.hasOwnProperty(h)){var m=u[h];if(!f||this.vals[h]!=m)for(var y in this.attrCommands[h]){var d=p(this.$el,"["+y+"]");d.attr(this.attrCommands[h][y],m)}}for(var h in this.textCommands)if(u.hasOwnProperty(h)){var m=u[h];if(!f||this.vals[h]!=m)for(var g=this.textCommands[h],v=0;v<g.length;v++)p(this.$el,"["+g[v]+"]").text(m)}for(var h in this.viewCommands)if(u.hasOwnProperty(h)){var t=u[h],w=this.vals[h],d=p(this.$el,"#"+this.viewCommands[h]);if(l(t)){if(f)if(l(w)){for(var C=Math.min(t.length,w.length),v=0;C>v;v++)w[v].typeHash!=t[v].typeHash&&(C=v);for(;w.length>C;)w[w.length-1].$el.remove(),w.length--}else{if(w instanceof a)w.$el.remove();else if(w instanceof Object)for(var b in w)w[b]instanceof a&&w[b].$el.remove();w=[]}else w=[];for(var v=0;v<w.length;v++)e(w[v],t[v]),t[v]=w[v];for(var v=w.length;v<t.length;v++)e(t[v]),d.before(t[v].$el)}else if(t instanceof a){var $=!0;if(f)if(l(w))for(var v=0;v<w.length;v++)w[v].$el.remove();else if(w instanceof a)w.typeHash!=t.typeHash?w.$el.remove():($=!1,e(w,t),u[h]=w);else if(w instanceof Object)for(var b in w)w[b]instanceof a&&w[b].$el.remove();$&&(e(t),d.before(t.$el))}else if(t instanceof Object){if(f){if(l(w)){for(var v=0;v<w.length;v++)w[v].$el.remove();w={}}else if(w instanceof a)w.$el.remove(),w={};else if(w instanceof Object)for(var T in w)w[T]instanceof a?t[T]instanceof a&&t[T].typeHash==w[T].typeHash||(w[T].$el.remove(),w[T]=void 0):w[T]=void 0}else w={};var O=[];for(var b in t)t[b]instanceof a&&O.push(b);t.__SORT__&&(t.__SORT__ instanceof Function?O.sort(t.__SORT__):O.sort());for(var v=O.length-1;v>=0;v--){var b=O[v];void 0==w[b]?(e(t[b]),(v+1==O.length?d:t[O[v+1]].$el).before(t[b].$el)):(e(w[b],t[b]),t[b]=w[b])}}}this.vals=u,this.listenTrgts=this.listeners instanceof Function?this.listeners.apply(this,this.state):this.listeners;for(var j in this.listenTrgts)this.watch(j);f||this.addControls.apply(this,[this.$el].concat(this.state)),this.updateControls.apply(this,[f,this.$el].concat(this.state));var x=(new Date).getTime()-i;this.updateTime=(4*(this.updateTime||x)+x)/5},a.prototype.watch=function(t){if(!this.prevValues.hasOwnProperty(t)){var e=p(this.$el,t),r=this;r.prevValues[t]=e.val();var n=function(){var n=e.val();if(n!=r.prevValues[t]){r.prevValues[t]=n;var o=r.listenTrgts[t]||[];l(o)||(o=[o]);for(var a=0;a<o.length;a++)o[a](n)}};e.keypress(n),e.keydown(n),e.keyup(n),e.change(n)}},i.compileView=function(e){function r(){this.state=Array.prototype.slice.call(arguments,0)}return e=e||{},r.prototype=new a,r.prototype.calc=e.calc||function(){return new Object},r.prototype.addControls=e.addControls||function(){},r.prototype.updateControls=e.updateControls||function(){},r.prototype.listeners=e.listeners||{},r.prototype.noMemoize=!!e.noMemoize,r.prototype.typeHash=s(),r.prototype.prevValues={},r.prototype.valCommands={},r.prototype.attrCommands={},r.prototype.textCommands={},r.prototype.viewCommands={},e.template=e.template||"",e.template=e.template.replace(/value={{\s*\w+\s*}}/g,function(t){var e=t.substr(8,t.length-10).trim(),n=s();return null==r.prototype.valCommands[e]&&(r.prototype.valCommands[e]=[]),r.prototype.valCommands[e].push(n),n}).replace(/[^\s]+={{\s*\w+\s*}}/g,function(t){var e=t.indexOf("="),n=t.substr(0,e),o=t.substr(e+3,t.length-e-5).trim(),a=s();return null==r.prototype.attrCommands[o]&&(r.prototype.attrCommands[o]={}),r.prototype.attrCommands[o][a]=n,a}).replace(/>\s*{{\s*\w+\s*}}\s*</g,function(t){var e=t.substr(1,t.length-2).trim();e=e.substr(2,e.length-4).trim();var n=s();return null==r.prototype.textCommands[e]&&(r.prototype.textCommands[e]=[]),r.prototype.textCommands[e].push(n)," "+n+"><"}).replace(/\[\[\s*\w+\s*\]\]/g,function(t){var e=t.substr(2,t.length-4).trim(),n=s();return r.prototype.viewCommands[e]=n,"<span id='"+n+"' style='display: none'></span>"}),r.prototype.getFreshJQ=function(){return t(e.template)},r};var u={};return i.defineType=function(e,r){r=r||{};var n=void 0,o=r.typeAttr||e;l(o)||(o=[o]);for(var a=t("<input>"),s=0;!n&&s<o.length;s++)a.attr("type",o[s]).prop("type")==o[s]&&(n=o[s]);return n||(n="text"),u.typeName={typeAttr:n,validator:r.validator instanceof RegExp?r.validator.test.bind(r.validator):r.validator instanceof Function?r.validator:function(){return!0},format:r.format instanceof Function?r.format:function(t){return t},unformat:r.unformat instanceof Function?r.unformat:function(t){return t}}},i.attachView=function(t,e){function r(){for(var t=[],r=0;r<o.length;r++)t.push(o[r].get());e.apply(this,t)}function n(){a.update(new r)}var o=Array.prototype.slice.call(arguments,2);r.prototype=e.prototype;var a=new r;a.update();for(var s=0;s<o.length;s++)o[s].listen(n);t.replaceWith(a.$el)},i});