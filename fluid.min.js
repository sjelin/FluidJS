var Fluid=function(t){"use strict";function e(t,e){return"function"==typeof Object.getPrototypeOf?Object.getPrototypeOf(t)==Object.getPrototypeOf(e):"object"==typeof"test".__proto__?t.__proto__==e.__proto__:t.constructor.prototype==e.constructor.prototype}function r(){}var o={},s=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};return o.model=function(t){this.val=t,this.listeners=[]},o.model.prototype.get=function(){return this.val},o.model.prototype.set=function(t){return this.val=t,this.alert(),t},o.model.prototype.listen=function(t){this.listeners.push(t)},o.model.prototype.alert=function(){for(var t=0;t<this.listeners.length;t++)this.listeners[t]()},r.prototype.update=function(t){this.state=(t||{}).state||this.state;var r=this.calc.apply(this,this.state),o=null!=this.vals;o||(this.$el=this.getFreshJQ(),this.vals={});for(var n in this.attrCommands){var i=r[n];if(!o||this.vals[n]!=i)for(var a in this.attrCommands[n]){var l=this.$el.is("["+a+"]")?this.$el:this.$el.find("["+a+"]");l.attr(this.attrCommands[n][a],i)}}for(var n in this.textCommands){var i=r[n];if(!o||this.vals[n]!=i)for(var p=this.textCommands[n],h=0;h<p.length;h++)(this.$el.is("["+p[h]+"]")?this.$el:this.$el.find("["+p[h]+"]")).text(i)}for(var n in this.viewCommands){var t=r[n],u=this.vals[n],l=this.$el.attr("id")==this.viewCommands[n]?this.$el:this.$el.find("#"+this.viewCommands[n]);if(s(t)){if(s(u)){var m=Math.min(t.length,u.length);for(m>0&&!e(u[0],t[0])&&(m=0);u.length>m;)u[u.length-1].$el.remove(),u.length--}else o&&u.$el.remove(),u=[];for(var h=0;h<u.length;h++)u[h].update(t[h]),t[h]=u[h];for(var h=u.length;h<t.length;h++)t[h].update(),l.before(t[h].$el)}else{var c=!0;if(o)if(s(u))for(var h=0;h<u.length;h++)u[h].$el.remove();else e(u,t)?(c=!1,u.update(t),r[n]=u):u.$el.remove();c&&(t.update(),l.before(t.$el))}}this.vals=r,this.setControls.apply(this,[!o,this.$el].concat(this.state))},o.compileView=function(e){function o(){this.state=Array.prototype.slice.call(arguments,0)}function s(){return"_"+Math.random().toString(36).substr(2)}return o.prototype=new r,o.prototype.calc=e.calc||function(){return new Object},o.prototype.setControls=e.setControls||function(){},o.prototype.attrCommands={},o.prototype.textCommands={},o.prototype.viewCommands={},e.template=e.template||"",e.template=e.template.replace(/[^\s]+={{\s*\w+\s*}}/g,function(t){var e=t.indexOf("="),r=t.substr(0,e),n=t.substr(e+3,t.length-e-5).trim(),i=s();return null==o.prototype.attrCommands[n]&&(o.prototype.attrCommands[n]={}),o.prototype.attrCommands[n][i]=r,i}).replace(/>\s*{{\s*\w+\s*}}\s*</g,function(t){var e=t.substr(1,t.length-2).trim();e=e.substr(2,e.length-4).trim();var r=s();return null==o.prototype.textCommands[e]&&(o.prototype.textCommands[e]=[]),o.prototype.textCommands[e].push(r)," "+r+"><"}).replace(/\[\[\s*\w+\s*\]\]/g,function(t){var e=t.substr(2,t.length-4).trim(),r=s();return o.prototype.viewCommands[e]=r,"<span id='"+r+"' style='display: none'></span>"}),o.prototype.getFreshJQ=function(){return t(e.template)},o},o.attachView=function(t,e){function r(){for(var t=[],r=0;r<s.length;r++)t.push(s[r].get());e.apply(this,t)}function o(){n.update(new r)}var s=Array.prototype.slice.call(arguments,2);r.prototype=e.prototype;var n=new r;n.update();for(var i=0;i<s.length;i++)s[i].listen(o);t.replaceWith(n.$el)},o}(jQuery);