!function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,t.jQuery||require("jquery")):function(){var t=require("jquery");return function(r){return e(r,r.jQuery||t(r))}}():t.Fluid=e(t,jQuery)}("undefined"!=typeof window?window:this,function(window,$){"use strict";function jqFind(t,e){return""==e?t:t.filter(e).add(t.find(e))}function rndStr(){return"_"+Math.random().toString(36).substr(2,6)+Math.random().toString(36).substr(2,6)}function isCheckable(t){var e=("INPUT"==t[0].tagName.toUpperCase()&&t.attr("type")||"").toUpperCase();return"CHECKBOX"==e||"RADIO"==e}function wrapExtFunctions(t,e){function r(t){return function(){return t.apply(this[i],arguments)}}var i=rndStr();for(var n in t)t[e+"_"+n]=r(t[n]);return i}function addExtFunctions(t){for(var e in t)null==extFuns[e]&&(extFuns[e]=[]),extFuns[e].push(t[e])}function callExtFun(){var t,e,r,i=arguments[0];"string"==typeof arguments[1]?(e=!1,t=arguments[1],r=Array.prototype.slice.call(arguments,2)):(e=arguments[1],t=arguments[2],r=Array.prototype.slice.call(arguments,3));for(var n=extFuns[t]||[],a=0;a<n.length;a++){var o=n[a].apply(i,r);e&&(r[0]=o)}return r[0]}function callExtFunWithArgsArray(){var t=Array.prototype.slice.call(arguments,0,arguments.length-1);return t.push.apply(t,arguments[arguments.length-1]),callExtFun.apply({},t)}function model_get(){return this()}function model_set(t){return this(t)}function addValSyntax(t){if(Object.defineProperty)try{Object.defineProperty(t,"val",{get:model_get,set:t.set})}catch(e){}}function model_sub(t){var e=this,r=function(){return arguments.length>0?(e()[t]=arguments[0],e.alert(),arguments[0]):e()[t]};return $.extend(r,e),addValSyntax(r),r}function AbstractView(){}function setVal(t,e,r){isCheckable(e)?e[0].checked=r:(r=callExtFun(t,!0,"view_preprocessValue",r,e),e.val()!=r&&(e.val(r),callExtFun(t,"view_postValueProcessing",r,e)))}function getEmptyObj(){return new Object}var Fluid={},isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};Fluid.utils={},Fluid.utils.rndAttrName=rndStr,Fluid.utils.isCheckable=isCheckable;var extFuns={};return Fluid.extendViews=function(t){var e=wrapExtFunctions(t,"view");t.view_initPrototype=function(){this[e]=function(){}},t.view_initInstance=function(){var t=this;this[e]=new this[e],this[e].getState=function(){return t.state},this[e].find=function(e){return jqFind(t.$el,e)}},addExtFunctions(t)},Fluid.extendModels=function(t){var e=wrapExtFunctions(t,"model");t.model_initInstance=function(){this[e]={}},addExtFunctions(t)},Fluid.newModel=function(t){var e=function(){return arguments.length>0&&(t=arguments[0],e.alert()),t};callExtFun(e,"model_initInstance"),t=callExtFunWithArgsArray(e,!0,"model_compile",arguments);var r=[];return e.listen=r.push.bind(r),e.alert=function(){for(var t=0;t<r.length;t++)r[t]();callExtFun(e,"model_alert",e)},e.get=model_get,e.set=model_set,e.sub=model_sub,addValSyntax(e),callExtFun(e,"model_init",e),e},AbstractView.prototype.update=function(t){if(void 0!==this.updateQueue)this.updateQueue.push(t);else{this.updateQueue=[],this.updateInner(t);for(var e=0;e<this.updateQueue.length;e++)this.updateInner(this.updateQueue[e]);this.updateQueue=void 0}},AbstractView.prototype.updateInner=function(t){function e(t,e){o-=(new Date).getTime(),1==arguments.length?t.update():t.update(e),o+=(new Date).getTime()}if(this.state=(t||{}).state||this.state,!this.noMemoize&&(this.memoTime||0)<=(this.updateTime||0)/2){var r=(new Date).getTime(),i=JSON.stringify(this.state),n=i==this.oldStateHash,a=(new Date).getTime()-r;if(this.memoTime=(4*(this.memoTime||a)+a)/5,n)return;this.oldStateHash=i}else this.oldStateHash=void 0;var o=(new Date).getTime(),s=this.fill.apply(this,this.state),l=null!=this.vals;if(!l){this.$el=$(this.template),this.vals={};for(var u=this.textNodes={},p=this.textCommands,c=function(t){if(t.nodeType==window.Node.TEXT_NODE){var e=p[t.nodeValue];void 0!==e&&(u[e]=u[e]||[]).push(t)}else for(var r=0,i=t.childNodes.length;i>r;r++)c(t.childNodes[r])},d=0;d<this.$el.length;d++)c(this.$el[d]);callExtFun(this,"view_initInstance"),callExtFun(this,"view_init")}for(var h in this.valCommands)if(s.hasOwnProperty(h))for(var m=s[h],f=this.valCommands[h],d=0;d<f.length;d++)setVal(this,jqFind(this.$el,"["+f[d]+"]"),m);for(var h in this.attrCommands)if(s.hasOwnProperty(h)){var m=s[h];if(!l||this.vals[h]!=m)for(var v in this.attrCommands[h]){var w=jqFind(this.$el,"["+v+"]");w.attr(this.attrCommands[h][v],m)}}for(var v in this.cmplxAttrCmds){for(var y=this.cmplxAttrCmds[v],m="",d=0;void 0!=m&&d<y.format.length;d++)d%2==0?m+=y.format[d]:s.hasOwnProperty(y.format[d])?m+=s[y.format[d]]:m=void 0;if(void 0!=m){var w=jqFind(this.$el,"["+v+"]");"VALUE"==y.attr.toUpperCase()?setVal(this,w,m):w.attr(y.attr,m)}}for(var h in this.textNodes)if(s.hasOwnProperty(h)){var m=s[h];if(!l||this.vals[h]!=m)for(var d=0,g=this.textNodes[h];d<g.length;d++)g[d].nodeValue=m}for(var h in this.viewCommands)if(s.hasOwnProperty(h)){var t=s[h],V=this.vals[h],w=jqFind(this.$el,"#"+this.viewCommands[h]);if(isArray(t)){for(var d=0;d<t.length;d++)this.assertIsView(t[d],h+"["+d+"]");if(l)if(isArray(V)){for(var x=Math.min(t.length,V.length),d=0;x>d;d++)V[d].typeHash!=t[d].typeHash&&(x=d);for(;V.length>x;)V[V.length-1].$el.remove(),V.length--}else{if(V instanceof AbstractView)V.$el.remove();else for(var F in V)V[F]instanceof AbstractView&&V[F].$el.remove();V=[]}else V=[];for(var d=0;d<V.length;d++)e(V[d],t[d]),t[d]=V[d];for(var d=V.length;d<t.length;d++)e(t[d]),w.before(t[d].$el)}else if(t instanceof AbstractView){var A=!0;if(l)if(isArray(V))for(var d=0;d<V.length;d++)V[d].$el.remove();else if(V instanceof AbstractView)V.typeHash!=t.typeHash?V.$el.remove():(A=!1,e(V,t),s[h]=V);else for(var F in V)V[F]instanceof AbstractView&&V[F].$el.remove();A&&(e(t),w.before(t.$el))}else if(t instanceof Object){if(l)if(isArray(V)){for(var d=0;d<V.length;d++)V[d].$el.remove();V={}}else if(V instanceof AbstractView)V.$el.remove(),V={};else for(var b in V)V[b]instanceof AbstractView?t[b]instanceof AbstractView&&t[b].typeHash==V[b].typeHash||(V[b].$el.remove(),V[b]=void 0):V[b]=void 0;else V={};var C=[];for(var F in t)t[F]instanceof AbstractView&&C.push(F);t.__SORT__&&(t.__SORT__ instanceof Function?C.sort(t.__SORT__):C.sort());for(var d=C.length-1;d>=0;d--){var F=C[d];void 0==V[F]?(e(t[F]),(d+1==C.length?w:t[C[d+1]].$el).before(t[F].$el)):(e(V[F],t[F]),t[F]=V[F])}}else this.throwNotView(t,h)}this.vals=s,callExtFun(this,"view_control"),l||this.addControls.apply(this,[this.$el].concat(this.state)),this.updateControls.apply(this,[l,this.$el].concat(this.state));var _=(new Date).getTime()-o;this.updateTime=(4*(this.updateTime||_)+_)/5},AbstractView.prototype.assertIsView=function(t,e){t instanceof AbstractView||this.throwNotView(t,e)},AbstractView.prototype.throwNotView=function(t,e){var r="fill() returned "+e+"="+JSON.stringify(t)+" as a view\n\nCalling view's compiled template is:\n	"+this.template.split("\n").join("\n	")+"\nNote that compiled templates don't look exactly like views original template";throw window.console.log(r),new TypeError(r)},Fluid.compileView=function(props){function View(){this.state=Array.prototype.slice.call(arguments,0)}View.prototype=new AbstractView,arguments.length=arguments.length||1,arguments[0]=props=props||{},callExtFun(View.prototype,"view_initPrototype");var protoProtos={};for(var key in View.prototype)protoProtos[key]=View.prototype[key].prototype;return callExtFunWithArgsArray(protoProtos,"view_compile",arguments),View.prototype.fill=props.fill||getEmptyObj,View.prototype.addControls=props.addControls||$.noop,View.prototype.updateControls=props.updateControls||$.noop,View.prototype.noMemoize=!!props.noMemoize,View.prototype.typeHash=rndStr(),View.prototype.valCommands={},View.prototype.attrCommands={},View.prototype.textCommands={},View.prototype.cmplxAttrCmds={},View.prototype.viewCommands={},View.prototype.template=callExtFun(protoProtos,!0,"view_modifyTemplate",props.template||"").replace(/[^\s]+=['"]{{\s*\w+\s*}}['"]/g,function(t){var e=t.lastIndexOf('"{{');return-1==e&&(e=t.lastIndexOf("'{{")),t.slice(0,e)+t.slice(e+1,-1)}).replace(/value={{\s*\w+\s*}}/g,function(t){var e=t.slice(8,-2).trim(),r=rndStr();return null==View.prototype.valCommands[e]&&(View.prototype.valCommands[e]=[]),View.prototype.valCommands[e].push(r),r}).replace(/[^\s]+={{\s*\w+\s*}}/g,function(t){var e=t.lastIndexOf("="),r=t.slice(0,e),i=t.slice(e+3,-2).trim(),n=rndStr();return null==View.prototype.attrCommands[i]&&(View.prototype.attrCommands[i]={}),View.prototype.attrCommands[i][n]=r,n}).replace(/[^\s]+=(?:"[^"]*?{{\s*\w+\s*}}(?:[^"]*?[^\\])?"|'[^']*?{{\s*\w+\s*}}(?:[^']*?[^\\])?')/g,function(match){var i=match.indexOf("="),attr=match.substr(0,i),q=match.substr(i+1,1),format=match.slice(i+2,-1).split(/{{|}}/);for(i=0;i<format.length;i+=2)format[i]=eval(q+format[i]+q);var id=rndStr();return View.prototype.cmplxAttrCmds[id]={attr:attr,format:format},id}).replace(/{{\s*\w+\s*}}/g,function(t){var e=t.slice(2,-2).trim(),r=rndStr();return View.prototype.textCommands[r]=e,"<span style='display: none'></span>"+r+"<span style='display: none'></span>"}).replace(/\[\[\s*\w+\s*\]\]/g,function(t){var e=t.slice(2,-2).trim(),r=rndStr();return View.prototype.viewCommands[e]=r,"<span id='"+r+"' style='display: none'></span>"}),View},Fluid.attachView=function(t,e){function r(){for(var t=[],r=0;r<n.length;r++)t.push(n[r].get());e.apply(this,t)}function i(){a.update(new r)}var n=Array.prototype.slice.call(arguments,2);r.prototype=e.prototype;var a=new r;a.update();for(var o=0;o<n.length;o++)n[o].listen(i);t.replaceWith(a.$el)},Fluid});