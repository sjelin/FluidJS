var Fluid=function(t){"use strict";function e(t,e){return"function"==typeof Object.getPrototypeOf?Object.getPrototypeOf(t)==Object.getPrototypeOf(e):"object"==typeof"test".__proto__?t.__proto__==e.__proto__:t.constructor.prototype==e.constructor.prototype}function r(){}var o={},s=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};return o.model=function(t){this.val=t,this.listeners=[]},o.model.prototype.get=function(){return this.val},o.model.prototype.set=function(t){return this.val=t,this.alert(),t},o.model.prototype.listen=function(t){this.listeners.push(t)},o.model.prototype.alert=function(){for(var t=0;t<this.listeners.length;t++)this.listeners[t]()},r.prototype.update=function(t){function r(t,e){l-=(new Date).getTime(),1==arguments.length?t.update():t.update(e),l+=(new Date).getTime()}if(this.state=(t||{}).state||this.state,!this.noMemoize&&(this.memoTime||0)<=(this.updateTime||0)/2){var o=(new Date).getTime(),i=JSON.stringify(this.state),n=i==this.oldStateHash,a=(new Date).getTime()-o;if(this.memoTime=(4*(this.memoTime||a)+a)/5,n)return;this.oldStateHash=i}else this.oldStateHash=void 0;var l=(new Date).getTime(),p=this.calc.apply(this,this.state),h=null!=this.vals;h||(this.$el=this.getFreshJQ(),this.vals={});for(var m in this.attrCommands)if(p.hasOwnProperty(m)){var u=p[m];if(!h||this.vals[m]!=u)for(var f in this.attrCommands[m]){var c=this.$el.is("["+f+"]")?this.$el:this.$el.find("["+f+"]");c.attr(this.attrCommands[m][f],u)}}for(var m in this.textCommands)if(p.hasOwnProperty(m)){var u=p[m];if(!h||this.vals[m]!=u)for(var v=this.textCommands[m],y=0;y<v.length;y++)(this.$el.is("["+v[y]+"]")?this.$el:this.$el.find("["+v[y]+"]")).text(u)}for(var m in this.viewCommands)if(p.hasOwnProperty(m)){var t=p[m],d=this.vals[m],c=this.$el.attr("id")==this.viewCommands[m]?this.$el:this.$el.find("#"+this.viewCommands[m]);if(s(t)){if(s(d)){var g=Math.min(t.length,d.length);for(g>0&&!e(d[0],t[0])&&(g=0);d.length>g;)d[d.length-1].$el.remove(),d.length--}else h&&d.$el.remove(),d=[];for(var y=0;y<d.length;y++)r(d[y],t[y]),t[y]=d[y];for(var y=d.length;y<t.length;y++)r(t[y]),c.before(t[y].$el)}else{var w=!0;if(h)if(s(d))for(var y=0;y<d.length;y++)d[y].$el.remove();else e(d,t)?(w=!1,r(d,t),p[m]=d):d.$el.remove();w&&(r(t),c.before(t.$el))}}this.vals=p,this.setControls.apply(this,[!h,this.$el].concat(this.state));var C=(new Date).getTime()-l;this.updateTime=(4*(this.updateTime||C)+C)/5},o.compileView=function(e){function o(){this.state=Array.prototype.slice.call(arguments,0)}function s(){return"_"+Math.random().toString(36).substr(2)}return o.prototype=new r,o.prototype.calc=e.calc||function(){return new Object},o.prototype.setControls=e.setControls||function(){},o.prototype.noMemoize=!!e.noMemoize,o.prototype.attrCommands={},o.prototype.textCommands={},o.prototype.viewCommands={},e.template=e.template||"",e.template=e.template.replace(/[^\s]+={{\s*\w+\s*}}/g,function(t){var e=t.indexOf("="),r=t.substr(0,e),i=t.substr(e+3,t.length-e-5).trim(),n=s();return null==o.prototype.attrCommands[i]&&(o.prototype.attrCommands[i]={}),o.prototype.attrCommands[i][n]=r,n}).replace(/>\s*{{\s*\w+\s*}}\s*</g,function(t){var e=t.substr(1,t.length-2).trim();e=e.substr(2,e.length-4).trim();var r=s();return null==o.prototype.textCommands[e]&&(o.prototype.textCommands[e]=[]),o.prototype.textCommands[e].push(r)," "+r+"><"}).replace(/\[\[\s*\w+\s*\]\]/g,function(t){var e=t.substr(2,t.length-4).trim(),r=s();return o.prototype.viewCommands[e]=r,"<span id='"+r+"' style='display: none'></span>"}),o.prototype.getFreshJQ=function(){return t(e.template)},o},o.attachView=function(t,e){function r(){for(var t=[],r=0;r<s.length;r++)t.push(s[r].get());e.apply(this,t)}function o(){i.update(new r)}var s=Array.prototype.slice.call(arguments,2);r.prototype=e.prototype;var i=new r;i.update();for(var n=0;n<s.length;n++)s[n].listen(o);t.replaceWith(i.$el)},o}(jQuery);