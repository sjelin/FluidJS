!function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,t.jQuery||require("jquery")):function(){var t=require("jquery");return function(r){return e(r,r.jQuery||t(r))}}():t.Fluid=e(t,jQuery)}("undefined"!=typeof window?window:this,function(window,$){"use strict";function jqFind(t,e){return""==e?t:t.filter(e).add(t.find(e))}function rndStr(){return"_"+Math.random().toString(36).substr(2,6)+Math.random().toString(36).substr(2,6)}function isCheckable(t){var e=("INPUT"==t[0].tagName.toUpperCase()&&t.attr("type")||"").toUpperCase();return"CHECKBOX"==e||"RADIO"==e}function wrapExtFunctions(t,e){function r(t){return function(){return t.apply(this[n],arguments)}}var n=rndStr();for(var i in t)t[e+"_"+i]=r(t[i]);return n}function addExtFunctions(t){for(var e in t)null==extFuns[e]&&(extFuns[e]=[]),extFuns[e].push(t[e])}function callExtFun(){var t,e,r,n=arguments[0];"string"==typeof arguments[1]?(e=!1,t=arguments[1],r=Array.prototype.slice.call(arguments,2)):(e=arguments[1],t=arguments[2],r=Array.prototype.slice.call(arguments,3));for(var i=extFuns[t]||[],o=0;o<i.length;o++){var a=i[o].apply(n,r);e&&(r[0]=a)}return r[0]}function callExtFunWithArgsArray(){var t=Array.prototype.slice.call(arguments,0,arguments.length-1);return t.push.apply(t,arguments[arguments.length-1]),callExtFun.apply({},t)}function model_get(){return this()}function model_set(t){return this(t)}function addValSyntax(t){if(Object.defineProperty)try{Object.defineProperty(t,"val",{get:model_get,set:t.set})}catch(e){}}function model_sub(t){var e=this,r=function(){return arguments.length>0?(e()[t]=arguments[0],e.alert(),arguments[0]):e()[t]};return $.extend(r,e),addValSyntax(r),r}function AbstractView(){}function setVal(t,e,r){isCheckable(e)?e[0].checked=r:(r=callExtFun(t,!0,"view_preprocessValue",r,e),e.val()!=r&&(e.val(r),callExtFun(t,"view_postValueProcessing",r,e)))}function getEmptyObj(){return new Object}var Fluid={},isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};Fluid.utils={},Fluid.utils.rndAttrName=rndStr,Fluid.utils.isCheckable=isCheckable;var extFuns={};return Fluid.extendViews=function(t){var e=wrapExtFunctions(t,"view");t.view_initPrototype=function(){this[e]=function(){}},t.view_initInstance=function(){var t=this;this[e]=new this[e],this[e].getState=function(){return t.state},this[e].find=function(e){return jqFind(t.$el,e)}},addExtFunctions(t)},Fluid.extendModels=function(t){var e=wrapExtFunctions(t,"model");t.model_initInstance=function(){this[e]={}},addExtFunctions(t)},Fluid.newModel=function(t){var e=function(){return arguments.length>0&&(t=arguments[0],e.alert()),t};callExtFun(e,"model_initInstance"),t=callExtFunWithArgsArray(e,!0,"model_compile",arguments);var r=[];return e.listen=r.push.bind(r),e.alert=function(){for(var t=0;t<r.length;t++)r[t]();callExtFun(e,"model_alert",e)},e.get=model_get,e.set=model_set,e.sub=model_sub,addValSyntax(e),callExtFun(e,"model_init",e),e},AbstractView.prototype.update=function(t){if(void 0!==this.updateQueue)this.updateQueue.push(t);else{this.updateQueue=[],this.updateInner(t);for(var e=0;e<this.updateQueue.length;e++)this.updateInner(this.updateQueue[e]);this.updateQueue=void 0}},AbstractView.prototype.updateInner=function(t){function e(t,e){a-=(new Date).getTime(),1==arguments.length?t.update():t.update(e),a+=(new Date).getTime()}if(this.state=(t||{}).state||this.state,!this.noMemoize&&(this.memoTime||0)<=(this.updateTime||0)/2){var r=(new Date).getTime(),n=JSON.stringify(this.state),i=n==this.oldStateHash,o=(new Date).getTime()-r;if(this.memoTime=(4*(this.memoTime||o)+o)/5,i)return;this.oldStateHash=n}else this.oldStateHash=void 0;var a=(new Date).getTime(),s=this.fill.apply(this,this.state),l=null!=this.vals;if(!l){this.$el=$(this.template),this.vals={};for(var p=this.textNodes={},u=this.textCommands,c=function(t){if(t.nodeType==window.Node.TEXT_NODE){var e=u[t.nodeValue];void 0!==e&&(p[e]=p[e]||[]).push(t)}else for(var r=0,n=t.childNodes.length;n>r;r++)c(t.childNodes[r])},m=0;m<this.$el.length;m++)c(this.$el[m]);callExtFun(this,"view_initInstance"),callExtFun(this,"view_init")}for(var d in this.valCommands)if(s.hasOwnProperty(d))for(var h=s[d],f=this.valCommands[d],m=0;m<f.length;m++)setVal(this,jqFind(this.$el,"["+f[m]+"]"),h);for(var d in this.attrCommands)if(s.hasOwnProperty(d)){var h=s[d];if(!l||this.vals[d]!=h)for(var v in this.attrCommands[d]){var w=jqFind(this.$el,"["+v+"]");w.attr(this.attrCommands[d][v],h)}}for(var v in this.cmplxAttrCmds){for(var y=this.cmplxAttrCmds[v],h="",m=0;void 0!=h&&m<y.format.length;m++)m%2==0?h+=y.format[m]:s.hasOwnProperty(y.format[m])?h+=s[y.format[m]]:h=void 0;if(void 0!=h){var w=jqFind(this.$el,"["+v+"]");"VALUE"==y.attr.toUpperCase()?setVal(this,w,h):w.attr(y.attr,h)}}for(var d in this.textNodes)if(s.hasOwnProperty(d)){var h=s[d];if(!l||this.vals[d]!=h)for(var m=0,g=this.textNodes[d];m<g.length;m++)g[m].nodeValue=h}for(var d in this.viewCommands)if(s.hasOwnProperty(d)){var t=s[d],V=this.vals[d],w=jqFind(this.$el,"#"+this.viewCommands[d]);if(isArray(t)){for(var m=0;m<t.length;m++)this.assertIsView(t[m],d+"["+m+"]");if(l)if(isArray(V)){for(var x=Math.min(t.length,V.length),m=0;x>m;m++)V[m].typeHash!=t[m].typeHash&&(x=m);for(;V.length>x;)V[V.length-1].$el.remove(),V.length--}else{if(V instanceof AbstractView)V.$el.remove();else for(var F in V)V[F]instanceof AbstractView&&V[F].$el.remove();V=[]}else V=[];for(var m=0;m<V.length;m++)e(V[m],t[m]),t[m]=V[m];for(var m=V.length;m<t.length;m++)e(t[m]),w.before(t[m].$el)}else if(t instanceof AbstractView){var b=!0;if(l)if(isArray(V))for(var m=0;m<V.length;m++)V[m].$el.remove();else if(V instanceof AbstractView)V.typeHash!=t.typeHash?V.$el.remove():(b=!1,e(V,t),s[d]=V);else for(var F in V)V[F]instanceof AbstractView&&V[F].$el.remove();b&&(e(t),w.before(t.$el))}else if(t instanceof Object){if(l)if(isArray(V)){for(var m=0;m<V.length;m++)V[m].$el.remove();V={}}else if(V instanceof AbstractView)V.$el.remove(),V={};else for(var A in V)V[A]instanceof AbstractView?t[A]instanceof AbstractView&&t[A].typeHash==V[A].typeHash||(V[A].$el.remove(),V[A]=void 0):V[A]=void 0;else V={};var C=[];for(var F in t)t[F]instanceof AbstractView&&C.push(F);t.__SORT__&&(t.__SORT__ instanceof Function?C.sort(t.__SORT__):C.sort());for(var m=C.length-1;m>=0;m--){var F=C[m];void 0==V[F]?(e(t[F]),(m+1==C.length?w:t[C[m+1]].$el).before(t[F].$el)):(e(V[F],t[F]),t[F]=V[F])}}else this.throwNotView(t,d)}this.vals=s,callExtFun(this,"view_control"),l||this.addControls.apply(this,[this.$el].concat(this.state)),this.updateControls.apply(this,[l,this.$el].concat(this.state));var _=(new Date).getTime()-a;this.updateTime=(4*(this.updateTime||_)+_)/5},AbstractView.prototype.assertIsView=function(t,e){t instanceof AbstractView||this.throwNotView(t,e)},AbstractView.prototype.throwNotView=function(t,e){var r="fill() returned "+e+"="+JSON.stringify(t)+" as a view\n\nCalling view's compiled template is:\n	"+this.template.split("\n").join("\n	")+"\nNote that compiled templates don't look exactly like views original template";throw window.console.log(r),new TypeError(r)},Fluid.compileView=function(props){function View(){this.state=Array.prototype.slice.call(arguments,0)}View.prototype=new AbstractView,arguments.length=arguments.length||1,arguments[0]=props=props||{},callExtFun(View.prototype,"view_initPrototype");var protoProtos={};for(var key in View.prototype)protoProtos[key]=View.prototype[key].prototype;callExtFunWithArgsArray(protoProtos,"view_compile",arguments),View.prototype.fill=props.fill||getEmptyObj,View.prototype.addControls=props.addControls||$.noop,View.prototype.updateControls=props.updateControls||$.noop,View.prototype.noMemoize=!!props.noMemoize,View.prototype.typeHash=rndStr(),View.prototype.valCommands={},View.prototype.attrCommands={},View.prototype.textCommands={},View.prototype.cmplxAttrCmds={},View.prototype.viewCommands={},View.prototype.template=callExtFun(protoProtos,!0,"view_modifyTemplate",props.template||"").replace(/[^\s]+=['"]{{\s*\w+\s*}}['"]/g,function(t){var e=t.lastIndexOf('"{{');return-1==e&&(e=t.lastIndexOf("'{{")),t.slice(0,e)+t.slice(e+1,-1)}).replace(/value={{\s*\w+\s*}}/g,function(t){var e=t.slice(8,-2).trim(),r=rndStr();return null==View.prototype.valCommands[e]&&(View.prototype.valCommands[e]=[]),View.prototype.valCommands[e].push(r),r}).replace(/[^\s]+={{\s*\w+\s*}}/g,function(t){var e=t.lastIndexOf("="),r=t.slice(0,e),n=t.slice(e+3,-2).trim(),i=rndStr();return null==View.prototype.attrCommands[n]&&(View.prototype.attrCommands[n]={}),View.prototype.attrCommands[n][i]=r,i}).replace(/[^\s]+=(?:"[^"]*?{{\s*\w+\s*}}(?:[^"]*?[^\\])?"|'[^']*?{{\s*\w+\s*}}(?:[^']*?[^\\])?')/g,function(match){var i=match.indexOf("="),attr=match.substr(0,i),q=match.substr(i+1,1),format=match.slice(i+2,-1).split(/{{|}}/);for(i=0;i<format.length;i+=2)format[i]=eval(q+format[i]+q);var id=rndStr();return View.prototype.cmplxAttrCmds[id]={attr:attr,format:format},id}).replace(/{{\s*\w+\s*}}/g,function(t){var e=t.slice(2,-2).trim(),r=rndStr();return View.prototype.textCommands[r]=e,"<span style='display: none'></span>"+r+"<span style='display: none'></span>"}).replace(/\[\[\s*\w+\s*\]\]/g,function(t){var e=t.slice(2,-2).trim(),r=rndStr();return View.prototype.viewCommands[e]=r,"<span id='"+r+"' style='display: none'></span>"});var $tmplt=$(View.prototype.template);for(var vname in View.prototype.viewCommands)if(0==jqFind($tmplt,"#"+View.prototype.viewCommands[vname]).parent().length){var msg="The following template contains a subview-injection which is not wrapped in a parent tag.  For technical reasons, this is not currently allowed.\n\nTemplate:\n"+props.template;throw window.console.log(msg),new SyntaxError(msg)}return View},Fluid.attachView=function(t,e){function r(){for(var t=[],r=0;r<i.length;r++)t.push(i[r].get());e.apply(this,t)}function n(){o.update(new r)}var i=Array.prototype.slice.call(arguments,2);r.prototype=e.prototype;var o=new r;o.update();for(var a=0;a<i.length;a++)i[a].listen(n);t.replaceWith(o.$el)},Fluid});