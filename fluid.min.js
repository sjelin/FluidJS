!function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=t.jQuery?e(t.jQuery):t.document?e(require("jquery")):function(){var t=require("jquery");return function(r){return e(r.jQuery||t(r))}}():t.Fluid=e(jQuery)}("undefined"!=typeof window?window:this,function(t){"use strict";function e(){return this()}function r(t){return this(t)}function n(t){if(Object.defineProperty)try{Object.defineProperty(t,"val",{get:e,set:t.set})}catch(r){}}function s(e){var r=this,s=function(){return arguments.length>0?(r()[e]=arguments[0],r.alert(),arguments[0]):r()[e]};return t.extend(s,r),n(s),s}function o(){}function a(){return"_"+Math.random().toString(36).substr(2,6)+Math.random().toString(36).substr(2,6)}var i={},l=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},p=function(t,e){return""==e?t:t.filter(e).add(t.find(e))};return i.newModel=function(t){var o=[],a=function(){return arguments.length>0&&(t=arguments[0],a.alert()),t};return a.listen=o.push.bind(o),a.alert=function(){for(var t=0;t<o.length;t++)o[t]()},a.get=e,a.set=r,a.sub=s,n(a),a},o.prototype.update=function(t){function e(t,e){i-=(new Date).getTime(),1==arguments.length?t.update():t.update(e),i+=(new Date).getTime()}if(this.state=(t||{}).state||this.state,!this.noMemoize&&(this.memoTime||0)<=(this.updateTime||0)/2){var r=(new Date).getTime(),n=JSON.stringify(this.state),s=n==this.oldStateHash,a=(new Date).getTime()-r;if(this.memoTime=(4*(this.memoTime||a)+a)/5,s)return;this.oldStateHash=n}else this.oldStateHash=void 0;var i=(new Date).getTime(),h=this.calc.apply(this,this.state),u=null!=this.vals;u||(this.$el=this.getFreshJQ(),this.vals={});for(var f in this.valCommands)if(h.hasOwnProperty(f))for(var m=h[f],c=this.valCommands[f],v=0;v<c.length;v++){var d=p(this.$el,"["+c[v]+"]");d.val()!=m&&d.val(m)}for(var f in this.attrCommands)if(h.hasOwnProperty(f)){var m=h[f];if(!u||this.vals[f]!=m)for(var y in this.attrCommands[f]){var d=p(this.$el,"["+y+"]");d.attr(this.attrCommands[f][y],m)}}for(var f in this.textCommands)if(h.hasOwnProperty(f)){var m=h[f];if(!u||this.vals[f]!=m)for(var g=this.textCommands[f],v=0;v<g.length;v++)p(this.$el,"["+g[v]+"]").text(m)}for(var f in this.viewCommands)if(h.hasOwnProperty(f)){var t=h[f],w=this.vals[f],d=p(this.$el,"#"+this.viewCommands[f]);if(l(t)){if(u)if(l(w)){for(var C=Math.min(t.length,w.length),v=0;C>v;v++)w[v].typeHash!=t[v].typeHash&&(C=v);for(;w.length>C;)w[w.length-1].$el.remove(),w.length--}else{if(w instanceof o)w.$el.remove();else if(w instanceof Object)for(var b in w)w[b]instanceof o&&w[b].$el.remove();w=[]}else w=[];for(var v=0;v<w.length;v++)e(w[v],t[v]),t[v]=w[v];for(var v=w.length;v<t.length;v++)e(t[v]),d.before(t[v].$el)}else if(t instanceof o){var $=!0;if(u)if(l(w))for(var v=0;v<w.length;v++)w[v].$el.remove();else if(w instanceof o)w.typeHash!=t.typeHash?w.$el.remove():($=!1,e(w,t),h[f]=w);else if(w instanceof Object)for(var b in w)w[b]instanceof o&&w[b].$el.remove();$&&(e(t),d.before(t.$el))}else if(t instanceof Object){if(u){if(l(w)){for(var v=0;v<w.length;v++)w[v].$el.remove();w={}}else if(w instanceof o)w.$el.remove(),w={};else if(w instanceof Object)for(var O in w)w[O]instanceof o?t[O]instanceof o&&t[O].typeHash==w[O].typeHash||(w[O].$el.remove(),w[O]=void 0):w[O]=void 0}else w={};var T=[];for(var b in t)t[b]instanceof o&&T.push(b);t.__SORT__&&(t.__SORT__ instanceof Function?T.sort(t.__SORT__):T.sort());for(var v=T.length-1;v>=0;v--){var b=T[v];void 0==w[b]?(e(t[b]),(v+1==T.length?d:t[T[v+1]].$el).before(t[b].$el)):(e(w[b],t[b]),t[b]=w[b])}}}this.vals=h,this.listenTrgts=this.listeners instanceof Function?this.listeners.apply(this,this.state):this.listeners;for(var j in this.listenTrgts)this.watch(j);u||this.addControls.apply(this,[this.$el].concat(this.state)),this.updateControls.apply(this,[u,this.$el].concat(this.state));var _=(new Date).getTime()-i;this.updateTime=(4*(this.updateTime||_)+_)/5},o.prototype.watch=function(t){if(!this.prevValues.hasOwnProperty(t)){var e=p(this.$el,t),r=this;r.prevValues[t]=e.val();var n=function(){var n=e.val();if(n!=r.prevValues[t]){r.prevValues[t]=n;var s=r.listenTrgts[t]||[];l(s)||(s=[s]);for(var o=0;o<s.length;o++)s[o](n)}};e.keypress(n),e.keydown(n),e.keyup(n),e.change(n)}},i.compileView=function(e){function r(){this.state=Array.prototype.slice.call(arguments,0)}return e=e||{},r.prototype=new o,r.prototype.calc=e.calc||function(){return new Object},r.prototype.addControls=e.addControls||function(){},r.prototype.updateControls=e.updateControls||function(){},r.prototype.listeners=e.listeners||{},r.prototype.noMemoize=!!e.noMemoize,r.prototype.typeHash=a(),r.prototype.prevValues={},r.prototype.valCommands={},r.prototype.attrCommands={},r.prototype.textCommands={},r.prototype.viewCommands={},e.template=e.template||"",e.template=e.template.replace(/value={{\s*\w+\s*}}/g,function(t){var e=t.substr(8,t.length-10).trim(),n=a();return null==r.prototype.valCommands[e]&&(r.prototype.valCommands[e]=[]),r.prototype.valCommands[e].push(n),n}).replace(/[^\s]+={{\s*\w+\s*}}/g,function(t){var e=t.indexOf("="),n=t.substr(0,e),s=t.substr(e+3,t.length-e-5).trim(),o=a();return null==r.prototype.attrCommands[s]&&(r.prototype.attrCommands[s]={}),r.prototype.attrCommands[s][o]=n,o}).replace(/>\s*{{\s*\w+\s*}}\s*</g,function(t){var e=t.substr(1,t.length-2).trim();e=e.substr(2,e.length-4).trim();var n=a();return null==r.prototype.textCommands[e]&&(r.prototype.textCommands[e]=[]),r.prototype.textCommands[e].push(n)," "+n+"><"}).replace(/\[\[\s*\w+\s*\]\]/g,function(t){var e=t.substr(2,t.length-4).trim(),n=a();return r.prototype.viewCommands[e]=n,"<span id='"+n+"' style='display: none'></span>"}),r.prototype.getFreshJQ=function(){return t(e.template)},r},i.attachView=function(t,e){function r(){for(var t=[],r=0;r<s.length;r++)t.push(s[r].get());e.apply(this,t)}function n(){o.update(new r)}var s=Array.prototype.slice.call(arguments,2);r.prototype=e.prototype;var o=new r;o.update();for(var a=0;a<s.length;a++)s[a].listen(n);t.replaceWith(o.$el)},i});