!function(t,e){return"object"!=typeof module||"object"!=typeof module.exports?e(t,jQuery,Fluid):(module.exports=t.jQuery&&t.Fluid?e(t,t.jQuery,t.Fluid):e,void 0)}("undefined"!=typeof window?window:this,function(t,e,r){"use strict";function n(e,r,n,i){if(e[0]instanceof t.HTMLInputElement||e[0]instanceof t.HTMLTextAreaElement)try{if(2==arguments.length&&(n=r),r=Math.min(r,n=Math.min(n,e.val().length)),elem.setSelectionRange)elem.setSelectionRange(r,n);else{var s=elem.createTextRange();s.collapse(!0),s.moveStart("character",r),s.moveEnd("character",n),s.select()}i&&(view.ctCursorPos[i]={s:r,e:n})}catch(a){}}function i(e){var r=e[0];if(r instanceof t.HTMLInputElement||r instanceof t.HTMLTextAreaElement)try{if(r.setSelectionRange)return{s:r.selectionStart,e:r.selectionEnd};var n=document.selection.createRange(),i=n.text.length;n.moveStart("character",-r.value.length);var s=n.text.length;return{s:s-i,e:s}}catch(a){}return{s:0,e:0}}function s(t,e,r){r.is(":focus")&&(t.ctCursorPos[e]=i(r))}function a(t,e,r,n){var i,s=0;for(i=0;e>i;i++)t(r[i])||s++;for(i=0;i<n.length&&s>0;i++)t(n[i])||s--;for(;i<n.length&&t(n[i]);)i++;return i}function o(t,e,r,n){for(;r>0&&n(t[r-1]);)r--;if(t.slice(0,r)!=e.slice(0,r))return!0;for(t=t.slice(r);t.length>0&&n(t[0]);)t=t.slice(1);for(e=e.slice(r);e.length>0&&n(e[0]);)e=e.slice(1);return t!=e}function u(t,e,r,n,i){if(n.length!=i.length-1||r.s!=r.e)return!1;r=r.s;var s=!1,a=!1;if(0==cusor){if(i.slice(1)!=n)return!1;a=!0}else if(r==i.length){if(i.slice(0,-1)!=n)return!1;s=!0}else{if((i.substr(0,r-1)!=n(0,r-1))(i.substr(r+1)!=n.substr(r)))return!1;var o=i.substr(r-1,2),u=n.substr(r-1,1);if(o[0]==u)a=!0;else{if(o[1]!=u)return!1;s=!0}}var f=null;if(s){for(;r>0&&e.formatChars(i[r-1]);)r--;if(0==r)return!1;f=e.unformat(i.slice(0,r-1)+i.slice(r))}else if(a){for(;r<i.length&&e.formatChars(i[r]);)r++;if(r==i.length)return!1;f=e.unformat(i.slice(0,r)+i.slice(r+1))}return null==f||e.validate(f)?!1:(t.val(e.format(f)),!0)}function f(t,e,r,s){var u=i(t),f=t.is(":focus");if(o(r,s,f?u.s:r.length,e.formatChars)){var l=void 0;f&&(l={s:a(e.formatChars,u.s,r,s),e:a(e.formatChars,u.e,r,s)}),t.val(s),void 0!=l&&n(t,l.s,l.e)}}function l(t,e,r){var i=r.val(),a=t.prevValues[e];if(i!=a){var o=t.ctCursorPos[e],l=t.ctMap[e],c=l.unformat(i);if(l.validate(c)){if(u(r,l,o,i,a)||f(r,l,i,l.format(c)),i=r.val(),c=l.unformat(i),l.unformat(a)!=c)for(var h=t.ctListeners[e],v=0;v<h.length;v++)h[v](c);t.prevValues[e]=i}else r.val(a),r.is(":focus")&&n(r,o.s,o.e)}s(t,e,r)}function c(t){return r.utils.isCheckable(t)?t[0].checked:t.val()}function h(t,e){function r(r){var n=t.listenTrgts[e]||[];"function"==typeof n&&(n=[n]);for(var i=0;i<n.length;i++)n[i](r)}if(!t.prevValues.hasOwnProperty(e)){var n=t.find(e);if(n.is("["+d+"]"))t.prevValues[e]=void 0,t.ctListeners[n.attr(d)].push(r);else{t.prevValues[e]=c(n);var i=function(){var i=c(n);i!=t.prevValues[e]&&r(t.prevValues[e]=i)};n.on("input",i),n.keypress(i),n.keydown(i),n.keyup(i),n.change(i)}}}function v(t){return((t||"")+"").split("").filter(function(t){return!this.formatChars(t)}.bind(this)).join("")}function p(t){return this.format(this.unformat(t))}var m={},d="__fluid__custom_type_hash";return r.defineInputType=function(t,r){r=r||{};var n=void 0,i=r.typeAttr||t;"string"==typeof i&&(i=[i]);for(var s=e("<input>"),a=0;!n&&a<i.length;a++)s.attr("type",i[a]).prop("type")==i[a]&&(n=i[a]);n||(n="text");for(var a=0;3>a;a++){var o=["validate","format","formatChars"][a];"object"!=typeof r[o]||r[o]instanceof RegExp||(r[o]=r[o][n])}var u=r.formatChars instanceof RegExp?r.formatChars.test.bind(r.formatChars):r.formatChars instanceof Function?r.formatChars:function(){return!1};return m[t]={attr:n,validate:r.validate instanceof RegExp?r.validate.test.bind(r.validate):r.validate instanceof Function?r.validate:function(){return!0},format:r.format instanceof Function?r.format:function(t){return t},formatChars:u,unformat:v,reformat:p}},r.extendViews({compile:function(t){this.listeners=t.listeners||{},this.ctMap={}},modifyTemplate:function(t){var e=this;return t.replace(/type=["']\s*\w*\s*["']/g,function(t){var n=t.slice(6,-1).trim();if(m[n]){var i=m[n],s=r.utils.rndAttrName();e.ctMap[s]=i;var a=t.slice(-1);return d+"="+a+s+a+" type="+a+i.attr+a}return t})},init:function(){this.vals={},this.prevValues={},this.ctListeners={},this.ctCursorPos={};for(var t in this.ctMap){var e=this.find("["+d+'="'+t+'"]');e.val(this.ctMap[t].reformat(e.val())),this.prevValues[t]=e.val(),this.ctListeners[t]=[];var r=l.bind(null,this,t,e),n=s.bind(null,this,t,e);e.on("input",r),e.keypress(r),e.keydown(r),e.keyup(r),e.change(r),e.click(n),e.mouseup(n),e.mousedown(n),e.focus(n)}},control:function(){this.listenTrgts=this.listeners instanceof Function?this.listeners(this.getState()):this.listeners;for(var t in this.listenTrgts)h(this,t)},preprocessValue:function(t,e){var r=e.attr(d);return r?this.ctMap[r].reformat(t):t},postValueProcessing:function(t,e){e.is(":focus")&&n(e,t.length,e.attr(d))}}),r});