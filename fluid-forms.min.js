!function(t,e){return"object"!=typeof module||"object"!=typeof module.exports?e(t,jQuery,Fluid):(module.exports=t.jQuery&&t.Fluid?e(t,t.jQuery,t.Fluid):e,void 0)}("undefined"!=typeof window?window:this,function(t,e,r){"use strict";function n(e,r,n,s,a){var o=e[0];if(o instanceof t.HTMLInputElement||o instanceof t.HTMLTextAreaElement)try{if(2==arguments.length&&(n=r),r=Math.min(r,n=Math.min(n,e.val().length)),o.setSelectionRange)o.setSelectionRange(r,n);else{var u=o.createTextRange();u.collapse(!0),u.moveStart("character",r),u.moveEnd("character",n),u.select()}s&&i(a,s,e)}catch(f){}}function s(e){var r=e[0];if(r instanceof t.HTMLInputElement||r instanceof t.HTMLTextAreaElement)try{if(r.setSelectionRange)return{s:r.selectionStart,e:r.selectionEnd};var n=document.selection.createRange(),s=n.text.length;n.moveStart("character",-r.value.length);var a=n.text.length;return{s:a-s,e:a}}catch(i){}return{s:0,e:0}}function a(e,r,n,s){(t.x=t.x||[]).push({s:e.s,e:e.e,oS:r.s,oE:r.e});for(var a=e.s;a<n.length&&s(n[a]);)a++;for(var i=e.e;i>0&&s(n[i-1]);)i--;if(e.s==a&&e.e==i)return!1;if(e.s==e.e){if(r.s==r.e&&e.e!=r.e){if(r.s==a)return e.s=e.e=Math.max(i-1,0),!0;if(r.s==i)return e.s=e.e=Math.min(a+1,n.length),!0}return e.s!=a&&e.e!=i?(e.s=e.e=a,!0):!1}return e.s=a,e.e=i,!0}function i(t,e,r){var i=s(r),o=""+r.val();t.prevValues[e]==o&&a(i,t.ctCursorPos[e],o,t.ctMap[e].formatChars)?n(r,i.s,i.e,e,t):t.ctCursorPos[e]=i}function o(t,e,r,n){var s,a=0;for(s=0;e>s;s++)t(r[s])||a++;for(s=0;s<n.length&&a>0;s++)t(n[s])||a--;for(;s<n.length&&t(n[s]);)s++;return s}function u(t,e,r,s,a,i,o){if(s.length!=a.length-1||r.s!=r.e)return!1;r=r.s;var u=!1,f=!1;if(0==r){if(a.slice(1)!=s)return!1;f=!0}else if(r==a.length){if(a.slice(0,-1)!=s)return!1;u=!0}else{if(a.substr(0,r-1)!=s.substr(0,r-1)||a.substr(r+1)!=s.substr(r))return!1;var l=a.substr(r-1,2),c=s.substr(r-1,1);if(l[0]==c)f=!0;else{if(l[1]!=c)return!1;u=!0}}var v=null;if(u){for(;r>0&&e.formatChars(a[r-1]);)r--;if(0==r)return!1;v=e.unformat(a.slice(0,r-1)+a.slice(r)),r--}else if(f){for(var h=r;h<a.length&&e.formatChars(a[h]);)h++;if(h==a.length)return!1;v=e.unformat(a.slice(0,h)+a.slice(h+1))}return null!=v&&e.validate(v)?(t.val(e.format(v)),n(t,r,r,i,o),!0):!1}function f(t,e,r,a,i,u){var f=void 0;if(t.is(":focus")){var l=s(t);f={s:o(e.formatChars,l.s,r,a),e:o(e.formatChars,l.e,r,a)}}t.val(a),void 0!=f&&n(t,f.s,f.e,i,u)}function l(t,e,r){t.val(e),t.is(":focus")&&n(t,r.s,r.e)}function c(t,e,r){var n=t.prevValues[e];if(!(r[0].validity||{valid:!0}).valid)return l(r,n,t.ctCursorPos[e]);var s=""+r.val();if(s!=n){var a=t.ctCursorPos[e],o=t.ctMap[e],c=o.unformat(s);if(o.validate(c)){var v=o.format(c);if(v!=s&&(u(r,o,a,s,n,e,t)||f(r,o,s,v,e,t),s=""+r.val(),c=o.unformat(s)),o.unformat(n)!=c)for(var h=t.ctListeners[e],p=0;p<h.length;p++)h[p](c);t.prevValues[e]=s}else l(r,n,a)}i(t,e,r)}function v(t){return r.utils.isCheckable(t)?t[0].checked:t.val()}function h(t,e){function r(r){var n=t.listenTrgts[e]||[];"function"==typeof n&&(n=[n]);for(var s=0;s<n.length;s++)n[s](r)}if(!t.prevValues.hasOwnProperty(e)){var n=t.find(e);if(n.is("["+g+"]")){t.prevValues[e]=void 0;var s=n.attr(g);r(t.ctMap[s].unformat(n.val())),t.ctListeners[s].push(r)}else{r(t.prevValues[e]=v(n));var a=function(){var s=v(n);s!=t.prevValues[e]&&r(t.prevValues[e]=s)};n.on("input",a),n.keypress(a),n.keydown(a),n.keyup(a),n.change(a)}}}function p(t){return((t||"")+"").split("").filter(function(t){return!this.formatChars(t)}.bind(this)).join("")}function m(t){return this.format(this.unformat(t))}var d={},g="__fluid__custom_type_hash";return r.defineInputType=function(t,r){r=r||{};var n=void 0,s=r.typeAttr||t;"string"==typeof s&&(s=[s]);for(var a=e("<input>"),i=0;!n&&i<s.length;i++)a.attr("type",s[i]).prop("type")==s[i]&&(n=s[i]);n||(n="text");for(var i=0;3>i;i++){var o=["validate","format","formatChars"][i];"object"!=typeof r[o]||r[o]instanceof RegExp||(r[o]=r[o][n])}var u=r.formatChars instanceof RegExp?r.formatChars.test.bind(r.formatChars):r.formatChars instanceof Function?r.formatChars:function(){return!1};return d[t]={attr:n,validate:r.validate instanceof RegExp?r.validate.test.bind(r.validate):r.validate instanceof Function?r.validate:function(){return!0},format:r.format instanceof Function?r.format:function(t){return t},formatChars:u,unformat:p,reformat:m}},r.extendViews({compile:function(t){this.listeners=t.listeners||{},this.ctMap={}},modifyTemplate:function(t){var e=this;return t.replace(/type=["']\s*[^"']*\s*["']/g,function(t){var n=t.slice(6,-1).trim();if(d[n]){var s=d[n],a=r.utils.rndAttrName();e.ctMap[a]=s;var i=t.slice(-1);return g+"="+i+a+i+" type="+i+s.attr+i}return t})},init:function(){this.vals={},this.prevValues={},this.ctListeners={},this.ctCursorPos={};for(var t in this.ctMap){var e=this.find("["+g+'="'+t+'"]'),r=this.ctMap[t].reformat(""+e.val());e.val(r),this.prevValues[t]=r,this.ctListeners[t]=[],this.ctCursorPos[t]={s:r.length,e:r.length};var n=c.bind({},this,t,e),s=i.bind({},this,t,e);e.on("input",n),e.keypress(n),e.keydown(n),e.keyup(n),e.change(n),e.click(s),e.mouseup(s),e.mousedown(s),e.focus(s)}},control:function(){this.listenTrgts=this.listeners instanceof Function?this.listeners.apply(this,this.getState()):this.listeners;for(var t in this.listenTrgts)h(this,t)},preprocessValue:function(t,e){var r=e.attr(g);return r?this.ctMap[r].reformat(t):t},postValueProcessing:function(t,e){e.is(":focus")&&n(e,t.length,t.length,e.attr(g),this)}}),r});