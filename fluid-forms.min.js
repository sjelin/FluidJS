!function(t,e){return"object"!=typeof module||"object"!=typeof module.exports?e(t,jQuery,Fluid):(module.exports=t.jQuery&&t.Fluid?e(t,t.jQuery,t.Fluid):e,void 0)}("undefined"!=typeof window?window:this,function(t,e,r){"use strict";function n(e,r,n,s,i){var o=e[0];if(o instanceof t.HTMLInputElement||o instanceof t.HTMLTextAreaElement)try{if(2==arguments.length&&(n=r),r=Math.min(r,n=Math.min(n,e.val().length)),o.setSelectionRange)o.setSelectionRange(r,n);else{var u=o.createTextRange();u.collapse(!0),u.moveStart("character",r),u.moveEnd("character",n),u.select()}s&&a(i,s,e)}catch(f){}}function s(e){var r=e[0];if(r instanceof t.HTMLInputElement||r instanceof t.HTMLTextAreaElement)try{if(r.setSelectionRange)return{s:r.selectionStart,e:r.selectionEnd};var n=document.selection.createRange(),s=n.text.length;n.moveStart("character",-r.value.length);var i=n.text.length;return{s:i-s,e:i}}catch(a){}return{s:0,e:0}}function i(e,r,n,s){(t.x=t.x||[]).push({s:e.s,e:e.e,oS:r.s,oE:r.e});for(var i=e.s;i<n.length&&s(n[i]);)i++;for(var a=e.e;a>0&&s(n[a-1]);)a--;if(e.s==i&&e.e==a)return!1;if(e.s==e.e){if(r.s==r.e&&e.e!=r.e){if(r.s==i)return e.s=e.e=Math.max(a-1,0),!0;if(r.s==a)return e.s=e.e=Math.min(i+1,n.length),!0}return e.s!=i&&e.e!=a?(e.s=e.e=i,!0):!1}return e.s=i,e.e=a,!0}function a(t,e,r){var a=s(r),o=""+r.val();t.prevValues[e]==o&&i(a,t.ctCursorPos[e],o,t.ctMap[e].formatChars)?n(r,a.s,a.e,e,t):t.ctCursorPos[e]=a}function o(t,e,r,n){var s,i=0;for(s=0;e>s;s++)t(r[s])||i++;for(s=0;s<n.length&&i>0;s++)t(n[s])||i--;for(;s<n.length&&t(n[s]);)s++;return s}function u(t,e,r,s,i,a,o){if(s.length!=i.length-1||r.s!=r.e)return!1;r=r.s;var u=!1,f=!1;if(0==r){if(i.slice(1)!=s)return!1;f=!0}else if(r==i.length){if(i.slice(0,-1)!=s)return!1;u=!0}else{if(i.substr(0,r-1)!=s.substr(0,r-1)||i.substr(r+1)!=s.substr(r))return!1;var l=i.substr(r-1,2),c=s.substr(r-1,1);if(l[0]==c)f=!0;else{if(l[1]!=c)return!1;u=!0}}var h=null;if(u){for(;r>0&&e.formatChars(i[r-1]);)r--;if(0==r)return!1;h=e.unformat(i.slice(0,r-1)+i.slice(r)),r--}else if(f){for(var v=r;v<i.length&&e.formatChars(i[v]);)v++;if(v==i.length)return!1;h=e.unformat(i.slice(0,v)+i.slice(v+1))}return null!=h&&e.validate(h)?(t.val(e.format(h)),n(t,r,r,a,o),!0):!1}function f(t,e,r,i,a,u){var f=void 0;if(t.is(":focus")){var l=s(t);f={s:o(e.formatChars,l.s,r,i),e:o(e.formatChars,l.e,r,i)}}t.val(i),void 0!=f&&n(t,f.s,f.e,a,u)}function l(t,e,r){t.val(e),t.is(":focus")&&n(t,r.s,r.e)}function c(t,e,r){var n=t.prevValues[e];if(!(r[0].validity||{valid:!0}).valid)return l(r,n,t.ctCursorPos[e]);var s=""+r.val();if(s!=n){var i=t.ctCursorPos[e],o=t.ctMap[e],c=o.unformat(s);if(o.validate(c)){if(u(r,o,i,s,n,e,t)||f(r,o,s,o.format(c),e,t),s=""+r.val(),c=o.unformat(s),o.unformat(n)!=c)for(var h=t.ctListeners[e],v=0;v<h.length;v++)h[v](c);t.prevValues[e]=s}else l(r,n,i)}a(t,e,r)}function h(t){return r.utils.isCheckable(t)?t[0].checked:t.val()}function v(t,e){function r(r){var n=t.listenTrgts[e]||[];"function"==typeof n&&(n=[n]);for(var s=0;s<n.length;s++)n[s](r)}if(!t.prevValues.hasOwnProperty(e)){var n=t.find(e);if(n.is("["+g+"]"))t.prevValues[e]=void 0,t.ctListeners[n.attr(g)].push(r);else{t.prevValues[e]=h(n);var s=function(){var s=h(n);s!=t.prevValues[e]&&r(t.prevValues[e]=s)};n.on("input",s),n.keypress(s),n.keydown(s),n.keyup(s),n.change(s)}}}function p(t){return((t||"")+"").split("").filter(function(t){return!this.formatChars(t)}.bind(this)).join("")}function m(t){return this.format(this.unformat(t))}var d={},g="__fluid__custom_type_hash";return r.defineInputType=function(t,r){r=r||{};var n=void 0,s=r.typeAttr||t;"string"==typeof s&&(s=[s]);for(var i=e("<input>"),a=0;!n&&a<s.length;a++)i.attr("type",s[a]).prop("type")==s[a]&&(n=s[a]);n||(n="text");for(var a=0;3>a;a++){var o=["validate","format","formatChars"][a];"object"!=typeof r[o]||r[o]instanceof RegExp||(r[o]=r[o][n])}var u=r.formatChars instanceof RegExp?r.formatChars.test.bind(r.formatChars):r.formatChars instanceof Function?r.formatChars:function(){return!1};return d[t]={attr:n,validate:r.validate instanceof RegExp?r.validate.test.bind(r.validate):r.validate instanceof Function?r.validate:function(){return!0},format:r.format instanceof Function?r.format:function(t){return t},formatChars:u,unformat:p,reformat:m}},r.extendViews({compile:function(t){this.listeners=t.listeners||{},this.ctMap={}},modifyTemplate:function(t){var e=this;return t.replace(/type=["']\s*[^"']*\s*["']/g,function(t){var n=t.slice(6,-1).trim();if(d[n]){var s=d[n],i=r.utils.rndAttrName();e.ctMap[i]=s;var a=t.slice(-1);return g+"="+a+i+a+" type="+a+s.attr+a}return t})},init:function(){this.vals={},this.prevValues={},this.ctListeners={},this.ctCursorPos={};for(var t in this.ctMap){var e=this.find("["+g+'="'+t+'"]'),r=this.ctMap[t].reformat(""+e.val());e.val(r),this.prevValues[t]=r,this.ctListeners[t]=[],this.ctCursorPos[t]={s:r.length,e:r.length};var n=c.bind({},this,t,e),s=a.bind({},this,t,e);e.on("input",n),e.keypress(n),e.keydown(n),e.keyup(n),e.change(n),e.click(s),e.mouseup(s),e.mousedown(s),e.focus(s)}},control:function(){this.listenTrgts=this.listeners instanceof Function?this.listeners(this.getState()):this.listeners;for(var t in this.listenTrgts)v(this,t)},preprocessValue:function(t,e){var r=e.attr(g);return r?this.ctMap[r].reformat(t):t},postValueProcessing:function(t,e){e.is(":focus")&&n(e,t.length,t.length,e.attr(g),this)}}),r});