!function(t,e){return"object"!=typeof module||"object"!=typeof module.exports?e(t,jQuery,Fluid):(module.exports=t.jQuery&&t.Fluid?e(t,t.jQuery,t.Fluid):e,void 0)}("undefined"!=typeof window?window:this,function(t,e,r){"use strict";function n(e,r,n,i){var s=e[0];if(s instanceof t.HTMLInputElement||s instanceof t.HTMLTextAreaElement)try{if(2==arguments.length&&(n=r),r=Math.min(r,n=Math.min(n,e.val().length)),s.setSelectionRange)s.setSelectionRange(r,n);else{var a=s.createTextRange();a.collapse(!0),a.moveStart("character",r),a.moveEnd("character",n),a.select()}i&&(view.ctCursorPos[i]={s:r,e:n})}catch(o){}}function i(e){var r=e[0];if(r instanceof t.HTMLInputElement||r instanceof t.HTMLTextAreaElement)try{if(r.setSelectionRange)return{s:r.selectionStart,e:r.selectionEnd};var n=document.selection.createRange(),i=n.text.length;n.moveStart("character",-r.value.length);var s=n.text.length;return{s:s-i,e:s}}catch(a){}return{s:0,e:0}}function s(t,e,r){r.is(":focus")&&(t.ctCursorPos[e]=i(r))}function a(t,e,r,n){var i,s=0;for(i=0;e>i;i++)t(r[i])||s++;for(i=0;i<n.length&&s>0;i++)t(n[i])||s--;for(;i<n.length&&t(n[i]);)i++;return i}function o(t,e,r,i,s,a){if(i.length!=s.length-1||r.s!=r.e)return!1;r=r.s;var o=!1,u=!1;if(0==r){if(s.slice(1)!=i)return!1;u=!0}else if(r==s.length){if(s.slice(0,-1)!=i)return!1;o=!0}else{if(s.substr(0,r-1)!=i.substr(0,r-1)||s.substr(r+1)!=i.substr(r))return!1;var f=s.substr(r-1,2),l=i.substr(r-1,1);if(f[0]==l)u=!0;else{if(f[1]!=l)return!1;o=!0}}var c=null;if(o){for(;r>0&&e.formatChars(s[r-1]);)r--;if(0==r)return!1;c=e.unformat(s.slice(0,r-1)+s.slice(r)),r--}else if(u){for(var v=r;v<s.length&&e.formatChars(s[v]);)v++;if(v==s.length)return!1;c=e.unformat(s.slice(0,v)+s.slice(v+1))}return null!=c&&e.validate(c)?(t.val(e.format(c)),n(t,r,r,a),!0):!1}function u(t,e,r,s,o){var u=void 0;if(t.is(":focus")){var f=i(t);u={s:a(e.formatChars,f.s,r,s),e:a(e.formatChars,f.e,r,s)}}t.val(s),void 0!=u&&n(t,u.s,u.e,o)}function f(t,e,r){t.val(e),t.is(":focus")&&n(t,r.s,r.e)}function l(t,e,r){var n=t.prevValues[e];if(!(r[0].validity||{valid:!0}).valid)return f(r,n,t.ctCursorPos[e]);var i=r.val();if(i!=n){var a=t.ctCursorPos[e],l=t.ctMap[e],c=l.unformat(i);if(l.validate(c)){if(o(r,l,a,i,n,e)||u(r,l,i,l.format(c),e),i=r.val(),c=l.unformat(i),l.unformat(n)!=c)for(var v=t.ctListeners[e],h=0;h<v.length;h++)v[h](c);t.prevValues[e]=i}else f(r,n,a)}s(t,e,r)}function c(t){return r.utils.isCheckable(t)?t[0].checked:t.val()}function v(t,e){function r(r){var n=t.listenTrgts[e]||[];"function"==typeof n&&(n=[n]);for(var i=0;i<n.length;i++)n[i](r)}if(!t.prevValues.hasOwnProperty(e)){var n=t.find(e);if(n.is("["+d+"]"))t.prevValues[e]=void 0,t.ctListeners[n.attr(d)].push(r);else{t.prevValues[e]=c(n);var i=function(){var i=c(n);i!=t.prevValues[e]&&r(t.prevValues[e]=i)};n.on("input",i),n.keypress(i),n.keydown(i),n.keyup(i),n.change(i)}}}function h(t){return((t||"")+"").split("").filter(function(t){return!this.formatChars(t)}.bind(this)).join("")}function p(t){return this.format(this.unformat(t))}var m={},d="__fluid__custom_type_hash";return r.defineInputType=function(t,r){r=r||{};var n=void 0,i=r.typeAttr||t;"string"==typeof i&&(i=[i]);for(var s=e("<input>"),a=0;!n&&a<i.length;a++)s.attr("type",i[a]).prop("type")==i[a]&&(n=i[a]);n||(n="text");for(var a=0;3>a;a++){var o=["validate","format","formatChars"][a];"object"!=typeof r[o]||r[o]instanceof RegExp||(r[o]=r[o][n])}var u=r.formatChars instanceof RegExp?r.formatChars.test.bind(r.formatChars):r.formatChars instanceof Function?r.formatChars:function(){return!1};return m[t]={attr:n,validate:r.validate instanceof RegExp?r.validate.test.bind(r.validate):r.validate instanceof Function?r.validate:function(){return!0},format:r.format instanceof Function?r.format:function(t){return t},formatChars:u,unformat:h,reformat:p}},r.extendViews({compile:function(t){this.listeners=t.listeners||{},this.ctMap={}},modifyTemplate:function(t){var e=this;return t.replace(/type=["']\s*[^"']*\s*["']/g,function(t){var n=t.slice(6,-1).trim();if(m[n]){var i=m[n],s=r.utils.rndAttrName();e.ctMap[s]=i;var a=t.slice(-1);return d+"="+a+s+a+" type="+a+i.attr+a}return t})},init:function(){this.vals={},this.prevValues={},this.ctListeners={},this.ctCursorPos={};for(var t in this.ctMap){var e=this.find("["+d+'="'+t+'"]');e.val(this.ctMap[t].reformat(e.val())),this.prevValues[t]=e.val(),this.ctListeners[t]=[];var r=l.bind(null,this,t,e),n=s.bind(null,this,t,e);e.on("input",r),e.keypress(r),e.keydown(r),e.keyup(r),e.change(r),e.click(n),e.mouseup(n),e.mousedown(n),e.focus(n)}},control:function(){this.listenTrgts=this.listeners instanceof Function?this.listeners(this.getState()):this.listeners;for(var t in this.listenTrgts)v(this,t)},preprocessValue:function(t,e){var r=e.attr(d);return r?this.ctMap[r].reformat(t):t},postValueProcessing:function(t,e){e.is(":focus")&&n(e,t.length,t.length,e.attr(d))}}),r});